name: Toolforge

on:
  - push
  - workflow_dispatch

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: garygrossgarten/github-action-ssh@2b10f41b5a33808f6d24eafd253296766308b7c4
        with:
          command: >-
            cd /data/project/sdzerobot/mwn || exit 1;
            git pull;
            npm run quickbuild;
            cd /data/project/sdzerobot/SDZeroBot || exit 1;
            git pull || exit 1;
            if [[ "$(git diff --name-only HEAD HEAD~1 | grep package.json)" -ne "" ]]; then
              npm install || exit 1;
            fi;
            npm run build || exit 1;
          host: login.toolforge.org
          username: ${{ secrets.TOOLFORGE_USERNAME }}
          privateKey: ${{ secrets.TOOLFORGE_PRIVATE_KEY }}

